Feature: User Login and Profile Management
  As a registered user
  I want to log in to my account and view my profile information
  So that I can access and review my personal, address, and payment details

  Background:
    Given the user is on the login page
    And the following user exists in the system:
      | email           | password    | status |
      | john@example.com| Password123!| active |

  @positive @login @smoke
  Scenario: Successful login with valid credentials
    When I enter valid email "john@example.com"
    And I enter valid password "Password123!"
    And I click the "Login" button
    Then I should be redirected to the dashboard page
    And I should see a welcome message "Welcome back, John!"
    And the login session should be established

  @positive @profile
  Scenario: View complete user profile after successful login
    Given I am logged in as "john@example.com"
    When I navigate to the user profile page
    Then I should see the user profile with all sections displayed:
      | section_name     |
      | Personal Info    |
      | Address Info     |
      | Payment Info     |
    And all profile information should be visible without additional clicks

  @positive @profile @personal-info
  Scenario: View personal information section with mock data
    Given I am logged in as "john@example.com"
    And I am on the user profile page
    Then I should see the "Personal Info" section with the following fields and data:
      | field_name        | field_type | required | current_value           | editable |
      | First Name        | text       | yes      | John                    | yes      |
      | Last Name         | text       | yes      | Smith                   | yes      |
      | Email Address     | email      | yes      | john@example.com        | yes      |
      | Phone Number      | tel        | no       | +1-555-123-4567         | yes      |
      | Date of Birth     | date       | no       | 1990-05-15              | yes      |
      | Gender            | select     | no       | Male                    | yes      |
      | Profile Picture   | image      | no       | profile_photo.jpg       | yes      |
      | Bio/Description   | textarea   | no       | Software developer from NYC | yes  |

  @positive @profile @address-info
  Scenario: View address information section with mock data
    Given I am logged in as "john@example.com"
    And I am on the user profile page
    Then I should see the "Address Info" section with the following fields and data:
      | field_name        | field_type | required | current_value           | editable |
      | Street Address 1  | text       | yes      | 123 Main Street         | yes      |
      | Street Address 2  | text       | no       | Apt 4B                  | yes      |
      | City              | text       | yes      | New York                | yes      |
      | State/Province    | select     | yes      | NY                      | yes      |
      | ZIP/Postal Code   | text       | yes      | 10001                   | yes      |
      | Country           | select     | yes      | United States           | yes      |
      | Address Type      | radio      | no       | Home                    | yes      |

  @positive @profile @payment-info
  Scenario: View payment information section with mock data
    Given I am logged in as "john@example.com"
    And I am on the user profile page
    Then I should see the "Payment Info" section with the following fields and data:
      | field_name           | field_type | required | current_value      | masked | editable |
      | Card Number          | text       | yes      | ****-****-****-1234| yes    | yes      |
      | Cardholder Name      | text       | yes      | John Smith         | no     | yes      |
      | Expiration Date      | date       | yes      | 12/2026            | no     | yes      |
      | CVV                  | text       | yes      | ***                | yes    | yes      |
      | Billing Address      | checkbox   | no       | Same as home       | no     | yes      |
      | Default Payment      | radio      | no       | Primary            | no     | yes      |
      | Card Type            | text       | no       | Visa               | no     | no       |

  @positive @profile @edit @personal-info
  Scenario: Successfully edit personal information
    Given I am logged in as "john@example.com"
    And I am on the user profile page
    When I click the "Edit" button in the "Personal Info" section
    And I update the following fields:
      | field_name     | new_value            |
      | First Name     | Jonathan             |
      | Phone Number   | +1-555-987-6543      |
      | Bio/Description| Senior Software Engineer |
    And I click the "Save Changes" button
    Then I should see a success message "Personal information updated successfully"
    And the fields should display the updated values:
      | field_name     | displayed_value      |
      | First Name     | Jonathan             |
      | Phone Number   | +1-555-987-6543      |
      | Bio/Description| Senior Software Engineer |

  @positive @profile @edit @address-info
  Scenario: Successfully edit address information
    Given I am logged in as "john@example.com"
    And I am on the user profile page
    When I click the "Edit" button in the "Address Info" section
    And I update the following fields:
      | field_name       | new_value        |
      | Street Address 2 | Suite 200        |
      | City             | Brooklyn         |
      | ZIP/Postal Code  | 11201            |
    And I click the "Save Changes" button
    Then I should see a success message "Address information updated successfully"
    And the fields should display the updated values:
      | field_name       | displayed_value  |
      | Street Address 2 | Suite 200        |
      | City             | Brooklyn         |
      | ZIP/Postal Code  | 11201            |

  @positive @profile @edit @payment-info
  Scenario: Successfully edit payment information
    Given I am logged in as "john@example.com"
    And I am on the user profile page
    When I click the "Edit" button in the "Payment Info" section
    And I update the following fields:
      | field_name      | new_value    |
      | Cardholder Name | Jonathan Smith |
      | Expiration Date | 08/2027      |
    And I click the "Save Changes" button
    Then I should see a success message "Payment information updated successfully"
    And the fields should display the updated values:
      | field_name      | displayed_value |
      | Cardholder Name | Jonathan Smith  |
      | Expiration Date | 08/2027         |

  @negative @profile @edit @validation @personal-info
  Scenario: Validation error when editing personal info with empty required fields
    Given I am logged in as "john@example.com"
    And I am on the user profile page
    When I click the "Edit" button in the "Personal Info" section
    And I clear the following required fields:
      | field_name  |
      | First Name  |
      | Last Name   |
    And I click the "Save Changes" button
    Then I should see the following validation errors:
      | field_name | error_message           |
      | First Name | First Name is required  |
      | Last Name  | Last Name is required   |
    And the changes should not be saved
    And I should remain in edit mode

  @negative @profile @edit @validation @personal-info
  Scenario: Validation error when editing personal info with invalid email
    Given I am logged in as "john@example.com"
    And I am on the user profile page
    When I click the "Edit" button in the "Personal Info" section
    And I update the "Email Address" field to "invalid-email-format"
    And I click the "Save Changes" button
    Then I should see a validation error "Please enter a valid email address"
    And the changes should not be saved
    And I should remain in edit mode

  @negative @profile @edit @validation @address-info
  Scenario: Validation error when editing address with empty required fields
    Given I am logged in as "john@example.com"
    And I am on the user profile page
    When I click the "Edit" button in the "Address Info" section
    And I clear the following required fields:
      | field_name        |
      | Street Address 1  |
      | City              |
      | ZIP/Postal Code   |
    And I click the "Save Changes" button
    Then I should see the following validation errors:
      | field_name        | error_message                 |
      | Street Address 1  | Street Address is required    |
      | City              | City is required              |
      | ZIP/Postal Code   | ZIP/Postal Code is required   |
    And the changes should not be saved
    And I should remain in edit mode

  @negative @profile @edit @validation @address-info
  Scenario: Validation error when editing address with invalid ZIP code format
    Given I am logged in as "john@example.com"
    And I am on the user profile page
    When I click the "Edit" button in the "Address Info" section
    And I update the "ZIP/Postal Code" field to "invalid-zip"
    And I click the "Save Changes" button
    Then I should see a validation error "Please enter a valid ZIP/Postal Code"
    And the changes should not be saved
    And I should remain in edit mode

  @negative @profile @edit @validation @payment-info
  Scenario: Validation error when editing payment info with empty required fields
    Given I am logged in as "john@example.com"
    And I am on the user profile page
    When I click the "Edit" button in the "Payment Info" section
    And I clear the following required fields:
      | field_name      |
      | Card Number     |
      | Cardholder Name |
      | Expiration Date |
      | CVV             |
    And I click the "Save Changes" button
    Then I should see the following validation errors:
      | field_name      | error_message                |
      | Card Number     | Card Number is required      |
      | Cardholder Name | Cardholder Name is required  |
      | Expiration Date | Expiration Date is required  |
      | CVV             | CVV is required              |
    And the changes should not be saved
    And I should remain in edit mode

  @negative @profile @edit @validation @payment-info
  Scenario: Validation error when editing payment info with invalid card number
    Given I am logged in as "john@example.com"
    And I am on the user profile page
    When I click the "Edit" button in the "Payment Info" section
    And I update the "Card Number" field to "1234-5678-9012"
    And I click the "Save Changes" button
    Then I should see a validation error "Please enter a valid 16-digit card number"
    And the changes should not be saved
    And I should remain in edit mode

  @negative @profile @edit @validation @payment-info
  Scenario: Validation error when editing payment info with expired card
    Given I am logged in as "john@example.com"
    And I am on the user profile page
    When I click the "Edit" button in the "Payment Info" section
    And I update the "Expiration Date" field to "01/2020"
    And I click the "Save Changes" button
    Then I should see a validation error "Card expiration date cannot be in the past"
    And the changes should not be saved
    And I should remain in edit mode

  @positive @profile @edit @cancel
  Scenario: Cancel editing without saving changes
    Given I am logged in as "john@example.com"
    And I am on the user profile page
    When I click the "Edit" button in the "Personal Info" section
    And I update the "First Name" field to "Modified Name"
    And I click the "Cancel" button
    Then I should see the original value "John" in the "First Name" field
    And I should exit edit mode
    And no changes should be saved

  @positive @profile @edit @multiple-sections
  Scenario: Edit multiple sections simultaneously
    Given I am logged in as "john@example.com"
    And I am on the user profile page
    When I click the "Edit" button in the "Personal Info" section
    And I click the "Edit" button in the "Address Info" section
    Then both sections should be in edit mode simultaneously
    And I should be able to modify fields in both sections
    And each section should have independent "Save" and "Cancel" buttons
  Scenario: Login attempt with invalid email format
    When I enter invalid email "invalid-email-format"
    And I enter valid password "Password123!"
    And I click the "Login" button
    Then I should see an error message "Please enter a valid email address"
    And I should remain on the login page
    And no login session should be established

  @negative @login @authentication
  Scenario: Login attempt with wrong email
    When I enter email "nonexistent@example.com"
    And I enter password "Password123!"
    And I click the "Login" button
    Then I should see an error message "Invalid email or password"
    And I should remain on the login page
    And no login session should be established

  @negative @login @authentication
  Scenario: Login attempt with wrong password
    When I enter email "john@example.com"
    And I enter password "WrongPassword123!"
    And I click the "Login" button
    Then I should see an error message "Invalid email or password"
    And I should remain on the login page
    And no login session should be established

  @negative @login @validation
  Scenario: Login attempt with empty email field
    When I leave the email field empty
    And I enter valid password "Password123!"
    And I click the "Login" button
    Then I should see an error message "Email is required"
    And the "Login" button should be disabled
    And I should remain on the login page

  @negative @login @validation
  Scenario: Login attempt with empty password field
    When I enter valid email "john@example.com"
    And I leave the password field empty
    And I click the "Login" button
    Then I should see an error message "Password is required"
    And the "Login" button should be disabled
    And I should remain on the login page

  @negative @login @validation
  Scenario: Login attempt with both fields empty
    When I leave the email field empty
    And I leave the password field empty
    And I click the "Login" button
    Then I should see the following error messages:
      | field    | message            |
      | email    | Email is required  |
      | password | Password is required |
    And the "Login" button should be disabled
    And I should remain on the login page

  @negative @login @security
  Scenario: Login attempt with inactive user account
    Given the following inactive user exists:
      | email              | password    | status   |
      | inactive@example.com| Password123!| inactive |
    When I enter email "inactive@example.com"
    And I enter password "Password123!"
    And I click the "Login" button
    Then I should see an error message "Account is inactive. Please contact support."
    And I should remain on the login page
    And no login session should be established

  @negative @login @security
  Scenario: Login attempt with locked user account
    Given the following locked user exists:
      | email            | password    | status | failed_attempts |
      | locked@example.com| Password123!| locked | 5               |
    When I enter email "locked@example.com"
    And I enter password "Password123!"
    And I click the "Login" button
    Then I should see an error message "Account is temporarily locked due to multiple failed login attempts"
    And I should remain on the login page
    And no login session should be established

  @negative @profile @authorization
  Scenario: Attempt to access profile without logging in
    Given I am not logged in
    When I attempt to navigate directly to the user profile page
    Then I should be redirected to the login page
    And I should see a message "Please log in to access your profile"

  @edge-case @login @security
  Scenario: Case sensitivity in email during login
    When I enter email "JOHN@EXAMPLE.COM"
    And I enter password "Password123!"
    And I click the "Login" button
    Then I should be successfully logged in
    And I should be redirected to the dashboard page

  @edge-case @login @validation
  Scenario: Login with email containing leading/trailing spaces
    When I enter email " john@example.com "
    And I enter password "Password123!"
    And I click the "Login" button
    Then the system should trim whitespace from email
    And I should be successfully logged in
    And I should be redirected to the dashboard page